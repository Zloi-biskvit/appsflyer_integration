groups:
- name: basic
  rules:
  - alert: HighCPU
    expr: avg(rate(node_cpu_seconds_total{mode!="idle"}[5m])) by (instance) > 0.8
    for: 5m
    labels: { severity: warning }
    annotations:
      summary: "Высокая CPU на {{ $labels.instance }}"
      description: "Средняя загрузка CPU > 80% в течение 5 минут."

  - alert: PostgresTooManyConnections
    expr: pg_stat_activity_count > 0.9 * pg_settings_max_connections
    for: 3m
    labels: { severity: critical }
    annotations:
      summary: "PostgreSQL почти упёрся в max_connections"

  - alert: PostgresReplicationLag
    expr: pg_replication_lag_bytes > 100000000
    for: 5m
    labels: { severity: warning }
    annotations:
      summary: "Лаг репликации PostgreSQL > 100MB"
